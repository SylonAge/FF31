<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karakter Y√∂netimi Sistemi</title>
    <style>
        /* TEMEL STƒ∞LLER */
        :root {
            --bg-primary: #f4f4f4;
            --bg-secondary: #fff;
            --text-color: #333;
            --header-bg: #e9e9e9;
            --header-color: #555;
            --main-header-color: #007bff;
            --divider-color: #ccc;
            --dice-bg: #f0f0f0;
            --dice-border: #ccc;

            /* ƒ∞statistik Renkleri */
            --stat-str: #ff5733;
            --stat-con: #008080;
            /* Yeni Dayanƒ±klƒ±lƒ±k rengi */
            --stat-bilgelik: #6a0572;
            --stat-dex: #008000;
            --stat-int: #007bff;
            --stat-cha: #ffd700;

            /* ƒ∞statistik Tint Renkleri */
            --stat-str-tint: rgba(255, 87, 51, 0.1);
            --stat-con-tint: rgba(0, 128, 128, 0.1);
            /* Yeni Dayanƒ±klƒ±lƒ±k tint rengi */
            --stat-bilgelik-tint: rgba(106, 5, 114, 0.1);
            --stat-dex-tint: rgba(0, 128, 0, 0.1);
            --stat-int-tint: rgba(0, 123, 255, 0.1);
            --stat-cha-tint: rgba(255, 215, 0, 0.1);

            /* HP/AC Renkleri */
            --hp-color: #28a745;
            --ac-color: #17a2b8;

            /* KAYIT/Y√úKLE BUTONLARI ƒ∞√áƒ∞N RENKLER */
            --save-button-bg: #28a745;
            --load-button-bg: #ffc107;
            --reset-button-bg: #dc3545;
            --main-menu-bg: #6c757d;
            --button-text-color: #fff;
        }

        /* GECE MODU */
        body.dark-mode {
            --bg-primary: #121212;
            --bg-secondary: #1e1e1e;
            --text-color: #e0e0e0;
            --header-bg: #2a2a2a;
            --header-color: #bbbbbb;
            --main-header-color: #4da6ff;
            --divider-color: #333;
            --dice-bg: #222;
            --dice-border: #555;
            color: var(--text-color);
            --stat-str: #e95151;
            --stat-con: #40e0d0;
            /* Yeni Dayanƒ±klƒ±lƒ±k rengi (Koyu Mod) */
            --stat-bilgelik: #c175c9;
            --stat-dex: #77dd77;
            --stat-int: #4da6ff;
            --stat-cha: #fff380;
            --stat-str-tint: rgba(233, 81, 81, 0.15);
            --stat-con-tint: rgba(64, 224, 208, 0.15);
            /* Yeni Dayanƒ±klƒ±lƒ±k tint rengi (Koyu Mod) */
            --stat-bilgelik-tint: rgba(193, 117, 201, 0.15);
            --stat-dex-tint: rgba(119, 221, 119, 0.15);
            --stat-int-tint: rgba(77, 166, 255, 0.15);
            --stat-cha-tint: rgba(255, 243, 128, 0.15);
            --save-button-bg: #1e7e34;
            --load-button-bg: #d39e00;
            --reset-button-bg: #c82333;
            --main-menu-bg: #495057;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: var(--bg-primary);
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--bg-secondary);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s, box-shadow 0.3s;
        }

        h1 {
            text-align: center;
            color: var(--main-header-color);
            border-bottom: 2px solid var(--divider-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .section-title {
            background-color: var(--header-bg);
            padding: 8px;
            margin-top: 25px;
            margin-bottom: 15px;
            border-radius: 4px;
            font-weight: bold;
            color: var(--header-color);
            transition: background-color 0.3s, color 0.3s;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        /* GENEL INPUT VE TEXTAREA STƒ∞LLERƒ∞ */
        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid var(--divider-color);
            border-radius: 4px;
            box-sizing: border-box;
            background-color: var(--bg-secondary);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }

        textarea {
            resize: vertical;
        }

        /* GRUPLAMA STƒ∞LLERƒ∞ */
        .stat-group {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .stat-item {
            flex: 1 1 calc(50% - 20px);
            min-width: 200px;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid var(--divider-color);
            transition: border-color 0.3s, background-color 0.3s;
        }

        .stat-group.basic-info {
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-group.basic-info .stat-item {
            flex: 1 1 150px;
            min-width: 120px;
            padding: 0;
            border: none;
        }

        .stat-group.basic-info .stat-item input,
        .stat-group.basic-info .stat-item select {
            margin-bottom: 5px;
        }

        .stat-group.basic-info .full-width {
            flex: 1 1 100%;
            padding: 0;
            border: none;
        }

        /* 6 istatistik i√ßin 3'l√º kolon stili g√ºncellenmedi, otomatik daƒüƒ±lƒ±m kullanƒ±lƒ±yor. */
        .stat-group.three-col .stat-item {
            flex: 1 1 calc(33.33% - 20px);
            min-width: 150px;
            padding: 10px;
            border: 1px solid var(--divider-color);
        }

        /* RENK STƒ∞LLERƒ∞ */
        .stat-item.fiziksel_guc {
            border-left: 5px solid var(--stat-str);
            background-color: var(--stat-str-tint);
        }

        .stat-item.dayaniklilik {
            border-left: 5px solid var(--stat-con);
            background-color: var(--stat-con-tint);
        }

        /* Yeni Dayanƒ±klƒ±lƒ±k stili */
        .stat-item.bilgelik {
            border-left: 5px solid var(--stat-bilgelik);
            background-color: var(--stat-bilgelik-tint);
        }

        .stat-item.ceviklik {
            border-left: 5px solid var(--stat-dex);
            background-color: var(--stat-dex-tint);
        }

        .stat-item.zeka {
            border-left: 5px solid var(--stat-int);
            background-color: var(--stat-int-tint);
        }

        .stat-item.karizma {
            border-left: 5px solid var(--stat-cha);
            background-color: var(--stat-cha-tint);
        }

        .stat-item.hp-box {
            border-left: 5px solid var(--hp-color);
            background-color: rgba(40, 167, 69, 0.1);
        }

        .stat-item.ac-box {
            border-left: 5px solid var(--ac-color);
            background-color: rgba(23, 162, 184, 0.1);
        }

        body.dark-mode .stat-item.hp-box {
            background-color: rgba(40, 167, 69, 0.2);
        }

        body.dark-mode .stat-item.ac-box {
            background-color: rgba(23, 162, 184, 0.2);
        }

        .race-bonus-text {
            font-size: 0.8em;
            color: var(--main-header-color);
            font-weight: normal;
            margin-left: 5px;
            cursor: pointer;
        }

        .race-bonus-text:hover {
            text-decoration: underline;
        }

        .value-bonus-group {
            display: flex;
            gap: 10px;
        }

        .value-input-container {
            flex: 2;
            display: flex;
            flex-direction: column;
        }

        .bonus-input-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .value-bonus-group input {
            margin-bottom: 0;
        }

        .calculated-bonus {
            background-color: #fffae6;
            color: #e65100;
            transition: background-color 0.3s, color 0.3s;
        }

        body.dark-mode .calculated-bonus {
            background-color: #4a3e26;
            color: #ffd700;
        }

        .priority-star {
            color: red;
            font-weight: bold;
            margin-left: 5px;
        }

        /* HP KONTROL STƒ∞LLERƒ∞ */
        .hp-bar-container {
            width: 100%;
            height: 15px;
            background-color: var(--dice-border);
            border-radius: 4px;
            margin-top: -10px;
            margin-bottom: 5px;
            overflow: hidden;
            border: 1px solid var(--divider-color);
        }

        #hpBar {
            height: 100%;
            width: 100%;
            background-color: #4CAF50;
            transition: width 0.3s ease, background-color 0.3s ease;
        }

        .hp-control-group {
            display: flex;
            gap: 10px;
            margin-top: -10px;
            margin-bottom: 15px;
        }

        .rest-control-group {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        .hp-control-group button,
        .rest-control-group button {
            flex: 1;
            padding: 8px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .hp-control-group #damageButton {
            background-color: #d93025;
            color: white;
        }

        .hp-control-group #healButton {
            background-color: #28a745;
            color: white;
        }

        .rest-control-group #shortRestButton {
            background-color: #ffc107;
            color: #333;
        }

        .rest-control-group #longRestButton {
            background-color: #17a2b8;
            color: white;
        }

        .hp-control-group input[type="text"] {
            flex: 1;
            margin-bottom: 0;
            text-align: center;
        }

        /* KAYIT / Y√úKLEME ALANI STƒ∞Lƒ∞ (SADECE YAPISAL SINIF KALDI) */
        .save-load-group {
            display: none;
        }

        /* Gizlendi */

        /* ZAR ATMA ALANI STƒ∞Lƒ∞ */
        .dice-roller {
            background-color: var(--dice-bg);
            padding: 15px;
            border: 2px solid var(--dice-border);
            border-radius: 6px;
            text-align: center;
            margin-top: 20px;
            margin-bottom: 20px;
            transition: background-color 0.3s, border-color 0.3s;
        }

        #rollButton,
        #baseAttackButton {
            background-color: var(--main-header-color);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.1em;
            margin-top: 10px;
            min-width: 200px;
        }

        #rollButton:hover {
            background-color: #0056b3;
        }

        #baseAttackButton {
            background-color: #dc3545;
        }

        #baseAttackButton:hover {
            background-color: #c82333;
        }

        #diceResult {
            font-size: 2em;
            font-weight: bold;
            color: #d93025;
            margin-top: 10px;
            min-height: 1.2em;
        }

        /* YETENEK HAVUZU & R√úTBE STƒ∞LLERƒ∞ */
        .skills-section-wrapper {
            display: flex;
            gap: 12px;
            align-items: flex-start;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .skills-text-column {
            flex: 2 1 70%;
            min-width: 280px;
        }

        .ability-text-area small {
            margin-top: 5px;
            color: var(--text-color);
            display: block;
            font-size: 0.8em;
        }

        .ability-slot-panel {
            width: min(360px, 100%);
        }

        .skills-header-text h3 {
            margin: 0;
            font-size: 1.1em;
        }

        .skills-header-text p {
            margin: 4px 0;
        }

        .slot-instruction {
            color: var(--text-color);
            font-size: 0.85em;
        }

        .rank-bonus-text {
            margin: 5px 0;
            font-size: 0.9em;
            color: var(--main-header-color);
        }

        .ability-pool-slots {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .ability-slot {
            border: none;
            border-radius: 6px;
            padding: 6px 4px;
            background: transparent;
            display: flex;
            align-items: center;
            gap: 12px;
            justify-content: flex-start;
            cursor: pointer;
            user-select: none;
        }

        /* Small square checkbox on the left */
        .ability-slot input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin: 0 8px 0 6px;
            appearance: none;
            -webkit-appearance: none;
            border: 2px solid rgba(255, 255, 255, 0.6);
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.02);
            display: inline-block;
            vertical-align: middle;
        }

        .ability-slot input[type="checkbox"]:checked {
            background: var(--main-header-color);
            border-color: var(--main-header-color);
        }

        /* Dark rounded label box on the right (fills remaining width) */
        .ability-slot-label {
            display: block;
            flex: 1 1 auto;
            padding: 10px 14px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.6);
            color: #fff;
            font-weight: 700;
            font-size: 0.95em;
            text-align: left;
        }

        /* Light-mode variant: lighter label box */
        body:not(.dark-mode) .ability-slot input[type="checkbox"] {
            border-color: #333;
            background: #fff;
            position: relative;
            box-shadow: none;
        }

        /* Draw a small white check mark when checked (works with custom appearance) */
        .ability-slot input[type="checkbox"]::after {
            content: "";
            position: absolute;
            left: 4px;
            top: 2px;
            width: 8px;
            height: 6px;
            transform: rotate(45deg) scale(0.9);
            border-bottom: 2px solid transparent;
            border-left: 2px solid transparent;
            pointer-events: none;
            opacity: 0;
        }

        body:not(.dark-mode) .ability-slot input[type="checkbox"]:checked {
            background: var(--main-header-color);
            border-color: var(--main-header-color);
        }

        body:not(.dark-mode) .ability-slot input[type="checkbox"]:checked::after {
            border-color: #fff;
            opacity: 1;
        }

        body:not(.dark-mode) .ability-slot-label {
            background: #f0f0f0;
            color: var(--text-color);
            border: 1px solid var(--divider-color);
        }

        .ability-pool-input {
            width: 100%;
            min-height: 55px;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid var(--divider-color);
            background-color: var(--bg-primary);
            color: var(--text-color);
        }

        .multi-dice-panel {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
        }

        .dice-control {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .dice-control label {
            font-weight: bold;
        }

        .dice-control input {
            width: 60px;
            padding: 6px;
            border-radius: 4px;
            border: 1px solid var(--divider-color);
            background-color: var(--bg-secondary);
            color: var(--text-color);
        }

        .multi-dice-btn {
            padding: 6px 10px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            background-color: #6f42c1;
            color: white;
            font-weight: bold;
            transition: background-color 0.2s;
        }

        .multi-dice-btn:hover {
            background-color: #5a32a3;
        }

        /* PROFƒ∞L FOTOƒûRAFI STƒ∞LLERƒ∞ */
        .profile-pic-section {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .profile-pic-container {
            width: 150px;
            height: 150px;
            border-radius: 12px;
            border: 2px dashed var(--divider-color);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
            overflow: hidden;
            background-color: var(--bg-secondary);
            transition: border-color 0.3s, background-color 0.3s;
        }

        .profile-pic-container:hover {
            border-color: var(--main-header-color);
            background-color: var(--header-bg);
        }

        #profilePicDisplay {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }

        .profile-pic-placeholder {
            text-align: center;
            color: var(--text-color);
            font-size: 0.8em;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .profile-pic-placeholder span:first-child {
            font-size: 2.5em;
            display: block;
        }

        .profile-pic-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 4px;
            font-size: 0.7em;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .profile-pic-container:hover .profile-pic-overlay {
            opacity: 1;
        }

        /* ZAR GE√áMƒ∞≈ûƒ∞ TABLOSU STƒ∞LLERƒ∞ */
        .dice-history-container {
            width: 100%;
            margin-top: 15px;
            margin-bottom: 20px;
        }

        .dice-history-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }

        .dice-history-table th,
        .dice-history-table td {
            border: 1px solid var(--divider-color);
            padding: 10px;
            text-align: center;
            transition: border-color 0.3s;
        }

        .dice-history-table th {
            background-color: #cce5ff;
            font-weight: bold;
            color: var(--text-color);
            transition: background-color 0.3s;
        }

        body.dark-mode .dice-history-table th {
            background-color: #b38a00;
            color: #fff;
        }

        .dice-history-table tbody tr:hover {
            background-color: var(--dice-bg);
        }

        body.dark-mode .dice-history-table tbody tr:hover {
            background-color: #2a2a2a;
        }

        .dice-history-table .critical-success {
            color: #76ff03;
            font-weight: bold;
        }

        .dice-history-table .critical-fail {
            color: #ff1744;
            font-weight: bold;
        }

        /* YETENEK TABLOSU STƒ∞LLERƒ∞ */
        .skills-items-layout {
            display: flex;
            gap: 30px;
        }

        .skills-table-container {
            flex: 0 0 40%;
            min-width: 300px;
        }

        .items-textarea-container {
            flex: 1 1 60%;
        }

        .skill-reference-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 0.9em;
        }

        .skill-reference-table th,
        .skill-reference-table td {
            border: 1px solid var(--divider-color);
            padding: 8px;
            text-align: left;
            transition: border-color 0.3s;
        }

        .skill-reference-table th {
            background-color: #cce5ff;
            font-weight: bold;
            color: var(--text-color);
            transition: background-color 0.3s;
        }

        body.dark-mode .skill-reference-table th {
            background-color: #b38a00;
            color: #fff;
        }

        body.dark-mode .skill-reference-table td:first-child {
            background-color: #2a2200;
        }

        body.dark-mode .skill-reference-table td a {
            color: white;
        }

        .skill-reference-table .skill-stat {
            font-weight: bold;
            color: #005c99;
        }

        body.dark-mode .skill-reference-table .skill-stat {
            color: #80bdff;
        }

        /* MODAL ZAR ATMA ANƒ∞MASYON STƒ∞LLERƒ∞ */
        #rollModal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            flex-direction: column;
            cursor: pointer;
        }

        #modalResult {
            color: white;
            font-size: 4em;
            font-weight: bold;
            text-align: center;
            padding: 40px;
            border-radius: 10px;
            background: linear-gradient(45deg, #333, #555);
            box-shadow: 0 0 50px rgba(255, 255, 255, 0.3);
            min-width: 300px;
            transition: all 0.5s ease;
        }

        #modalTitle {
            color: #ccc;
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .modal-rolling {
            animation: shake 0.1s cubic-bezier(.36, .07, .19, .97) both infinite;
            text-shadow: 0 0 10px white;
        }

        /* YENƒ∞ MEN√ú VE KONTROL STƒ∞LLERƒ∞ */
        #mainMenu {
            max-width: 600px;
            margin: 50px auto;
            padding: 40px;
            background-color: var(--bg-secondary);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: background-color 0.3s, color 0.3s;
        }

        .menu-button,
        .char-list-item button {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            color: var(--button-text-color);
            transition: background-color 0.3s;
        }

        #newCharacterButton {
            background-color: var(--save-button-bg);
        }

        #newCharacterButton:hover {
            background-color: #1e7e34;
        }

        #goToCharacterListButton {
            background-color: var(--main-header-color);
        }

        #goToCharacterListButton:hover {
            background-color: #0056b3;
        }

        #characterListContainer {
            margin-top: 20px;
        }

        .char-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border: 1px solid var(--divider-color);
            border-radius: 4px;
            margin-bottom: 10px;
            background-color: var(--header-bg);
            transition: background-color 0.3s, border-color 0.3s;
        }

        .char-list-item span {
            flex-grow: 1;
            font-weight: bold;
            color: var(--text-color);
        }

        .char-list-item button {
            width: 100px;
            margin-left: 10px;
            margin-bottom: 0;
            font-size: 0.9em;
            padding: 6px;
        }

        .char-list-item .load-btn {
            background-color: var(--load-button-bg);
            color: #333;
        }

        .char-list-item .delete-btn {
            background-color: var(--reset-button-bg);
        }

        #backToMenuButton {
            background-color: var(--main-menu-bg);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 15px;
        }

        #characterSheetContainer {
            display: none;
        }

        .top-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1001;
        }

        .top-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            font-size: 0.9em;
            transition: opacity 0.2s;
        }

        .top-btn:hover {
            opacity: 0.8;
        }

        .btn-dark {
            background-color: #6c757d;
        }

        .btn-info {
            background-color: #17a2b8;
        }

        .btn-success {
            background-color: #28a745;
        }

        /* Responsive d√ºzenleme */
        @media (max-width: 900px) {
            .skills-items-layout {
                flex-direction: column;
            }

            .skills-table-container,
            .items-textarea-container {
                flex: 1 1 100%;
                min-width: initial;
            }

            .stat-group.three-col .stat-item {
                flex: 1 1 calc(50% - 20px);
            }

            .stat-group.basic-info {
                flex-direction: column;
            }

            .stat-group.basic-info .stat-item {
                min-width: 100%;
            }

            .save-load-group {
                flex-direction: column;
            }
        }

        /* DICE ROLLER REDESIGN STYLES */
        .dice-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
        }

        .quick-btn {
            flex: 1;
            padding: 12px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transition: transform 0.1s, opacity 0.2s;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .quick-btn:active {
            transform: scale(0.98);
        }

        .quick-btn:hover {
            opacity: 0.9;
        }

        .btn-d20 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-attack {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
        }

        .dice-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 10px;
        }

        .dice-card {
            background: rgba(128, 128, 128, 0.1);
            border: 1px solid var(--divider-color);
            border-radius: 8px;
            padding: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .dice-card label {
            margin: 0;
            font-size: 0.85em;
            font-weight: bold;
            color: var(--header-color);
        }

        .dice-input-group {
            display: flex;
            width: 100%;
            height: 35px;
        }

        .dice-input-group input {
            width: 45px;
            text-align: center;
            border-radius: 4px 0 0 4px;
            border: 1px solid var(--divider-color);
            border-right: none;
            margin: 0;
            padding: 5px;
            font-weight: bold;
        }

        .dice-input-group button {
            flex: 1;
            border-radius: 0 4px 4px 0;
            margin: 0;
            background-color: var(--main-header-color);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: background-color 0.2s;
        }

        .dice-input-group button:hover {
            background-color: var(--main-menu-bg);
        }

        .dice-control {
            display: none;
        }
    </style>
</head>

<body>

    <div class="top-controls">
        <button id="darkModeToggle" onclick="toggleDarkMode()" class="top-btn btn-dark">üåô Gece Modu A√ß</button>
        <button id="importCharacterTopButton" onclick="importCharacterFromFile()" class="top-btn btn-info">üì• Karakter
            ƒ∞√ße Aktar</button>
    </div>

    <div id="rollModal">
        <div id="modalTitle"></div>
        <div id="modalResult">Zar Atƒ±lƒ±yor...</div>
        <p style="color: #ccc; margin-top: 30px;">Sonucu g√∂rmek ve kapatmak i√ßin tƒ±klayƒ±n.</p>
    </div>

    <div id="mainMenu">
        <h1>Karakter Y√∂netimi Ana Men√º</h1>
        <p>L√ºtfen bir i≈ülem se√ßiniz:</p>

        <button id="newCharacterButton" onclick="showCharacterSheet(true)" class="menu-button">+ YENƒ∞ KARAKTER
            OLU≈ûTUR</button>

        <div id="characterListContainer">
            <h3
                style="margin-top: 20px; border-top: 1px solid var(--divider-color); padding-top: 20px; color: var(--text-color);">
                Kayƒ±tlƒ± Karakterler</h3>
            <ul id="charList" style="list-style: none; padding: 0;">
            </ul>
        </div>
    </div>

    <div id="characterSheetContainer" class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <button id="backToMenuButton" onclick="saveCurrentAndGoToMenu()">‚óÄ Ana Men√ºye D√∂n & Kaydet</button>
            <h1>Karakter Kaƒüƒ±dƒ±</h1>
        </div>

        <div class="section-title">‚ú® Temel Bilgiler</div>
        <div class="profile-pic-section">
            <div class="profile-pic-container" onclick="document.getElementById('profilePicInput').click()">
                <div id="profilePicPlaceholder" class="profile-pic-placeholder">
                    <span>üì∑</span>
                    <span>Fotoƒüraf Y√ºkle</span>
                </div>
                <img id="profilePicDisplay" src="" alt="Profil Fotoƒürafƒ±">
                <div class="profile-pic-overlay">Deƒüi≈ütir</div>
                <input type="file" id="profilePicInput" style="display: none;" accept="image/*"
                    onchange="handleProfilePicUpload(this)">
            </div>
            <div class="stat-group basic-info" style="flex: 1;">
                <div class="stat-item"><label for="isim">ƒ∞Sƒ∞M</label><input type="text" id="isim" name="isim"></div>
                <div class="stat-item">
                    <label for="sinif">SINIF</label>
                    <select id="sinif" name="sinif" onchange="updateCharacterSheet()">
                        <option value="">-- Se√ßiniz --</option>
                    </select>
                </div>
                <div class="stat-item">
                    <label for="irk">IRK</label>
                    <select id="irk" name="irk" onchange="updateCharacterSheet()">
                        <option value="">-- Se√ßiniz --</option>
                    </select>
                </div>
                <div class="stat-item"><label for="yas">YA≈û</label><input type="text" id="yas" name="yas"></div>
                <div class="stat-item">
                    <label for="rutbe">R√úTBE</label>
                    <select id="rutbe" name="rutbe" onchange="updateCharacterSheet()">
                        <option value="bronz" selected>Bronz</option>
                        <option value="gumus">G√ºm√º≈ü</option>
                        <option value="altin">Altƒ±n</option>
                        <option value="elmas">Elmas</option>
                        <option value="platin">Platin</option>
                    </select>
                </div>

            </div>
        </div>

        <div class="section-title">üìä ƒ∞statistikler</div>
        <p id="raceBonusWarning" style="margin-top: -10px; margin-bottom: 20px; font-style: italic;">Not: Irk bonuslarƒ±
            otomatik *eklenmez*.
            L√ºtfen istatistik deƒüerlerine manuel ekleyiniz.</p>

        <div class="hp-armor-group stat-group">
            <div class="stat-item hp-box" style="width: 100%;">
                <label for="can">CAN (Mevcut / Maks.)</label>
                <input type="text" id="can" name="can" placeholder="√ñrn: 100 / 112" readonly>
                <div class="hp-bar-container">
                    <div id="hpBar"></div>
                </div>
            </div>
        </div>

        <div class="hp-control-group full-width">
            <input type="text" id="hpValueInput" placeholder="Deƒüer">
            <button id="damageButton">Hasar Al</button>
            <button id="healButton">ƒ∞yile≈ütir</button>
        </div>

        <div class="rest-control-group full-width">
            <button id="shortRestButton">Kƒ±sa Dinlenme (HP/2)</button>
            <button id="longRestButton">Uzun Dinlenme (Full HP)</button>
        </div>

        <div class="stat-group three-col">
            <div class="stat-item fiziksel_guc">
                <label>Fƒ∞Zƒ∞KSEL G√ú√á<span id="fiziksel_guc_race_bonus" class="race-bonus-text"
                        onclick="applyRaceBonus('fiziksel_guc')"></span></label>
                <div class="value-bonus-group">
                    <div class="value-input-container">
                        <select id="fiziksel_guc_val" name="fiziksel_guc_val" class="stat-select"
                            onchange="handleStatChange('fiziksel_guc')">
                            <option value="">Se√ß</option>
                        </select>
                        <label for="fiziksel_guc_val">Deƒüer</label>
                    </div>
                    <div class="bonus-input-container"><input type="text" id="fiziksel_guc_bonus"
                            name="fiziksel_guc_bonus" placeholder="+0" readonly class="calculated-bonus"><label
                            for="fiziksel_guc_bonus">Bonus</label></div>
                </div>
            </div>

            <div class="stat-item dayaniklilik">
                <label>DAYANIKLILIK<span id="dayaniklilik_race_bonus" class="race-bonus-text"
                        onclick="applyRaceBonus('dayaniklilik')"></span></label>
                <div class="value-bonus-group">
                    <div class="value-input-container">
                        <select id="dayaniklilik_val" name="dayaniklilik_val" class="stat-select"
                            onchange="handleStatChange('dayaniklilik')">
                            <option value="">Se√ß</option>
                        </select>
                        <label for="dayaniklilik_val">Deƒüer</label>
                    </div>
                    <div class="bonus-input-container"><input type="text" id="dayaniklilik_bonus"
                            name="dayaniklilik_bonus" placeholder="+0" readonly class="calculated-bonus"><label
                            for="dayaniklilik_bonus">Bonus</label></div>
                </div>
            </div>
            <div class="stat-item bilgelik">
                <label>Bƒ∞LGELƒ∞K<span id="bilgelik_race_bonus" class="race-bonus-text"
                        onclick="applyRaceBonus('bilgelik')"></span></label>
                <div class="value-bonus-group">
                    <div class="value-input-container">
                        <select id="bilgelik_val" name="bilgelik_val" class="stat-select"
                            onchange="handleStatChange('bilgelik')">
                            <option value="">Se√ß</option>
                        </select>
                        <label for="bilgelik_val">Deƒüer</label>
                    </div>
                    <div class="bonus-input-container"><input type="text" id="bilgelik_bonus" name="bilgelik_bonus"
                            placeholder="+0" readonly class="calculated-bonus"><label for="bilgelik_bonus">Bonus</label>
                    </div>
                </div>
            </div>

            <div class="stat-item ceviklik">
                <label>√áEVƒ∞KLƒ∞K<span id="ceviklik_race_bonus" class="race-bonus-text"
                        onclick="applyRaceBonus('ceviklik')"></span></label>
                <div class="value-bonus-group">
                    <div class="value-input-container">
                        <select id="ceviklik_val" name="ceviklik_val" class="stat-select"
                            onchange="handleStatChange('ceviklik')">
                            <option value="">Se√ß</option>
                        </select>
                        <label for="ceviklik_val">Deƒüer</label>
                    </div>
                    <div class="bonus-input-container"><input type="text" id="ceviklik_bonus" name="ceviklik_bonus"
                            placeholder="+0" readonly class="calculated-bonus"><label for="ceviklik_bonus">Bonus</label>
                    </div>
                </div>
            </div>

            <div class="stat-item zeka">
                <label>ZEKA<span id="zeka_race_bonus" class="race-bonus-text"
                        onclick="applyRaceBonus('zeka')"></span></label>
                <div class="value-bonus-group">
                    <div class="value-input-container">
                        <select id="zeka_val" name="zeka_val" class="stat-select" onchange="handleStatChange('zeka')">
                            <option value="">Se√ß</option>
                        </select>
                        <label for="zeka_val">Deƒüer</label>
                    </div>
                    <div class="bonus-input-container"><input type="text" id="zeka_bonus" name="zeka_bonus"
                            placeholder="+0" readonly class="calculated-bonus"><label for="zeka_bonus">Bonus</label>
                    </div>
                </div>
            </div>

            <div class="stat-item karizma">
                <label>KARƒ∞ZMA<span id="karizma_race_bonus" class="race-bonus-text"
                        onclick="applyRaceBonus('karizma')"></span></label>
                <div class="value-bonus-group">
                    <div class="value-input-container">
                        <select id="karizma_val" name="karizma_val" class="stat-select"
                            onchange="handleStatChange('karizma')">
                            <option value="">Se√ß</option>
                        </select>
                        <label for="karizma_val">Deƒüer</label>
                    </div>
                    <div class="bonus-input-container"><input type="text" id="karizma_bonus" name="karizma_bonus"
                            placeholder="+0" readonly class="calculated-bonus"><label for="karizma_bonus">Bonus</label>
                    </div>
                </div>
            </div>
        </div>

        <div class="dice-roller">
            <div class="dice-panel">
                <!-- Row 1: Quick Actions -->
                <div class="quick-actions">
                    <button id="rollButton" class="quick-btn btn-d20">üé≤ D20 ZAR AT</button>
                    <button id="baseAttackButton" class="quick-btn btn-attack">‚öîÔ∏è TEMEL SALDIRI</button>
                </div>

                <!-- Row 2: Multi Dice Grid -->
                <div class="dice-grid">
                    <!-- D4 -->
                    <div class="dice-card">
                        <label for="diceCount-4">D4</label>
                        <div class="dice-input-group">
                            <input type="number" id="diceCount-4" min="1" value="1">
                            <button type="button" class="multi-dice-btn" data-dice="4">AT</button>
                        </div>
                    </div>
                    <!-- D6 -->
                    <div class="dice-card">
                        <label for="diceCount-6">D6</label>
                        <div class="dice-input-group">
                            <input type="number" id="diceCount-6" min="1" value="1">
                            <button type="button" class="multi-dice-btn" data-dice="6">AT</button>
                        </div>
                    </div>
                    <!-- D8 -->
                    <div class="dice-card">
                        <label for="diceCount-8">D8</label>
                        <div class="dice-input-group">
                            <input type="number" id="diceCount-8" min="1" value="1">
                            <button type="button" class="multi-dice-btn" data-dice="8">AT</button>
                        </div>
                    </div>
                    <!-- D10 -->
                    <div class="dice-card">
                        <label for="diceCount-10">D10</label>
                        <div class="dice-input-group">
                            <input type="number" id="diceCount-10" min="1" value="1">
                            <button type="button" class="multi-dice-btn" data-dice="10">AT</button>
                        </div>
                    </div>
                    <!-- D12 -->
                    <div class="dice-card">
                        <label for="diceCount-12">D12</label>
                        <div class="dice-input-group">
                            <input type="number" id="diceCount-12" min="1" value="1">
                            <button type="button" class="multi-dice-btn" data-dice="12">AT</button>
                        </div>
                    </div>
                    <!-- D20 Multi -->
                    <div class="dice-card">
                        <label for="diceCount-20">D20 (√áoklu)</label>
                        <div class="dice-input-group">
                            <input type="number" id="diceCount-20" min="1" value="1">
                            <button type="button" class="multi-dice-btn" data-dice="20">AT</button>
                        </div>
                    </div>
                </div>

                <div id="diceResult"
                    style="text-align: center; margin-top: 5px; font-weight: bold; color: var(--text-color);">---</div>
            </div>
        </div>

        <div class="section-title">‚öîÔ∏è Yetenekler ve E≈üyalar</div>

        <div class="skills-items-layout">
            <div class="skills-table-container">
                <h3 style="margin-top: -10px;">Yetenek (Skill) Hƒ±zlƒ± Referans</h3>
                <table class="skill-reference-table" id="skillReferenceTable">
                    <thead>
                        <tr>
                            <th>Yetenek (Skill)</th>
                            <th style="width: 30%;">Kullanƒ±lacak ƒ∞statistik</th>
                            <th style="width: 15%;">Bonus</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr data-stat-key="ceviklik">
                            <td><a href="javascript:void(0);"
                                    onclick="rollSkillCheck('ceviklik', 'Acrobatics (Akrobasi)')">Acrobatics (Akrobasi)
                                    üé≤</a></td>
                            <td class="skill-stat">√áEVƒ∞KLƒ∞K</td>
                            <td class="skill-bonus"></td>
                        </tr>
                        <tr data-stat-key="bilgelik">
                            <td><a href="javascript:void(0);"
                                    onclick="rollSkillCheck('bilgelik', 'Animal Handling (Hayvan ƒ∞daresi)')">Animal
                                    Handling (Hayvan ƒ∞daresi) üé≤</a></td>
                            <td class="skill-stat">Bƒ∞LGELƒ∞K</td>
                            <td class="skill-bonus"></td>
                        </tr>
                        <tr data-stat-key="zeka">
                            <td><a href="javascript:void(0);" onclick="rollSkillCheck('zeka', 'Arcana (Gizem)')">Arcana
                                    (Gizem) üé≤</a></td>
                            <td class="skill-stat">ZEKA</td>
                            <td class="skill-bonus"></td>
                        </tr>
                        <tr data-stat-key="fiziksel_guc">
                            <td><a href="javascript:void(0);"
                                    onclick="rollSkillCheck('fiziksel_guc', 'Athletics (Atletizm)')">Athletics
                                    (Atletizm) üé≤</a></td>
                            <td class="skill-stat">Fƒ∞Zƒ∞KSEL G√ú√á</td>
                            <td class="skill-bonus"></td>
                        </tr>
                        <tr data-stat-key="karizma">
                            <td><a href="javascript:void(0);"
                                    onclick="rollSkillCheck('karizma', 'Deception (Kandƒ±rma)')">Deception (Kandƒ±rma)
                                    üé≤</a></td>
                            <td class="skill-stat">KARƒ∞ZMA</td>
                            <td class="skill-bonus"></td>
                        </tr>
                        <tr data-stat-key="zeka">
                            <td><a href="javascript:void(0);"
                                    onclick="rollSkillCheck('zeka', 'History (Tarih)')">History (Tarih) üé≤</a></td>
                            <td class="skill-stat">ZEKA</td>
                            <td class="skill-bonus"></td>
                        </tr>
                        <tr data-stat-key="bilgelik">
                            <td><a href="javascript:void(0);"
                                    onclick="rollSkillCheck('bilgelik', 'Insight (Sezgi)')">Insight (Sezgi) üé≤</a></td>
                            <td class="skill-stat">Bƒ∞LGELƒ∞K</td>
                            <td class="skill-bonus"></td>
                        </tr>
                        <tr data-stat-key="karizma">
                            <td><a href="javascript:void(0);"
                                    onclick="rollSkillCheck('karizma', 'Intimidation (Korkutma)')">Intimidation
                                    (Korkutma) üé≤</a></td>
                            <td class="skill-stat">KARƒ∞ZMA</td>
                            <td class="skill-bonus"></td>
                        </tr>
                        <tr data-stat-key="zeka">
                            <td><a href="javascript:void(0);"
                                    onclick="rollSkillCheck('zeka', 'Investigation (Ara≈ütƒ±rma)')">Investigation
                                    (Ara≈ütƒ±rma) üé≤</a></td>
                            <td class="skill-stat">ZEKA</td>
                            <td class="skill-bonus"></td>
                        </tr>
                        <tr data-stat-key="bilgelik">
                            <td><a href="javascript:void(0);"
                                    onclick="rollSkillCheck('bilgelik', 'Medicine (Tƒ±p)')">Medicine (Tƒ±p) üé≤</a></td>
                            <td class="skill-stat">Bƒ∞LGELƒ∞K</td>
                            <td class="skill-bonus"></td>
                        </tr>
                        <tr data-stat-key="zeka">
                            <td><a href="javascript:void(0);" onclick="rollSkillCheck('zeka', 'Nature (Doƒüa)')">Nature
                                    (Doƒüa) üé≤</a></td>
                            <td class="skill-stat">ZEKA</td>
                            <td class="skill-bonus"></td>
                        </tr>
                        <tr data-stat-key="bilgelik">
                            <td><a href="javascript:void(0);"
                                    onclick="rollSkillCheck('bilgelik', 'Perception (Algƒ±)')">Perception (Algƒ±) üé≤</a>
                            </td>
                            <td class="skill-stat">Bƒ∞LGELƒ∞K</td>
                            <td class="skill-bonus"></td>
                        </tr>
                        <tr data-stat-key="karizma">
                            <td><a href="javascript:void(0);"
                                    onclick="rollSkillCheck('karizma', 'Performance (G√∂steri)')">Performance (G√∂steri)
                                    üé≤</a></td>
                            <td class="skill-stat">KARƒ∞ZMA</td>
                            <td class="skill-bonus"></td>
                        </tr>
                        <tr data-stat-key="karizma">
                            <td><a href="javascript:void(0);"
                                    onclick="rollSkillCheck('karizma', 'Persuasion (ƒ∞kna)')">Persuasion (ƒ∞kna) üé≤</a>
                            </td>
                            <td class="skill-stat">KARƒ∞ZMA</td>
                            <td class="skill-bonus"></td>
                        </tr>
                        <tr data-stat-key="zeka">
                            <td><a href="javascript:void(0);"
                                    onclick="rollSkillCheck('zeka', 'Religion (Din)')">Religion (Din) üé≤</a></td>
                            <td class="skill-stat">ZEKA</td>
                            <td class="skill-bonus"></td>
                        </tr>
                        <tr data-stat-key="ceviklik">
                            <td><a href="javascript:void(0);"
                                    onclick="rollSkillCheck('ceviklik', 'Sleight of Hand (El √áabukluƒüu)')">Sleight of
                                    Hand (El √áabukluƒüu) üé≤</a></td>
                            <td class="skill-stat">√áEVƒ∞KLƒ∞K</td>
                            <td class="skill-bonus"></td>
                        </tr>
                        <tr data-stat-key="ceviklik">
                            <td><a href="javascript:void(0);"
                                    onclick="rollSkillCheck('ceviklik', 'Stealth (Gizlenme)')">Stealth (Gizlenme) üé≤</a>
                            </td>
                            <td class="skill-stat">√áEVƒ∞KLƒ∞K</td>
                            <td class="skill-bonus"></td>
                        </tr>
                        <tr data-stat-key="bilgelik">
                            <td><a href="javascript:void(0);"
                                    onclick="rollSkillCheck('bilgelik', 'Survival (Hayatta Kalma)')">Survival (Hayatta
                                    Kalma) üé≤</a></td>
                            <td class="skill-stat">Bƒ∞LGELƒ∞K</td>
                            <td class="skill-bonus"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="items-textarea-container">
                <div class="skills-section-wrapper">
                    <div class="skills-text-column">
                        <div class="stat-item full-width ability-text-area">
                            <label for="yetenekler">YETENEKLER / B√úY√úLER</label>
                            <textarea id="yetenekler" name="yetenekler" rows="8"
                                placeholder="Aktif b√ºy√ºlerinizi ya da yeteneklerinizi buraya not alabilirsiniz..."></textarea>
                        </div>
                    </div>
                    <div class="ability-slot-panel">
                        <div class="skills-header-text">
                            <h3>Yetenek/B√ºy√º Slotlarƒ±</h3>
                            <p class="rank-bonus-text" id="rankDiceBonusLabel">Bronz r√ºtbesi t√ºm zaralara +0 bonus verir
                                ve 1 yetenek slotu sunar.</p>
                        </div>
                        <div id="abilityPoolSlots" class="ability-pool-slots"></div>
                    </div>
                </div>
                <div class="stat-group">
                    <div class="stat-item full-width"><label for="pasif_yetenekler">PASƒ∞F YETENEKLER</label><textarea
                            id="pasif_yetenekler" name="pasif_yetenekler" rows="8"
                            placeholder="Pasif yeteneklerinizi ve etkilerini buraya yazƒ±n..."></textarea></div>
                    <div class="stat-item full-width"><label for="itemler">ITEMLER</label><textarea id="itemler"
                            name="itemler" rows="10" placeholder="Envanterinizdeki e≈üyalarƒ± listeleyin..."></textarea>
                    </div>
                </div>
            </div>
        </div>

        <p style="text-align: center; margin-top: 30px;">Bu form, **FRP** karakterinizi olu≈üturmanƒ±z i√ßin
            tasarlanmƒ±≈ütƒ±r. @SylonAge</p>

        <div class="section-title">üìú Son Zarlar (Son 10)</div>
        <div class="dice-history-container">
            <table id="diceHistoryTable" class="dice-history-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Zar Tipi</th>
                        <th>Sonu√ß</th>
                        <th>Zaman</th>
                    </tr>
                </thead>
                <tbody id="diceHistoryBody">
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 15px; color: var(--text-color);">Hen√ºz zar
                            atƒ±lmadƒ±</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // KARAKTER VERƒ∞LERƒ∞
        const CLASS_HP = {
            "Barbarian (Barbar)": 130, "Fighter (Sava≈ü√ßƒ±)": 125, "Paladin (Paladin)": 120,
            "Cleric (Ruhban)": 115, "Ranger (Bek√ßi)": 115, "Monk (Ke≈üi≈ü)": 110,
            "Rogue (Hƒ±rsƒ±z)": 110, "Bard (Ozan)": 105, "Druid (Druid)": 105,
            "Warlock (B√ºy√ºc√º)": 105, "Sorcerer (B√ºy√ºc√º)": 100, "Wizard (B√ºy√ºc√º)": 100
        };

        const RACE_STAT_BONUSES = {
            "ƒ∞nsan": { stats: { 'fiziksel_guc': 1, 'dayaniklilik': 1, 'bilgelik': 1, 'ceviklik': 1, 'zeka': 1, 'karizma': 1 }, hp: 0 },
            "Elf": { stats: { 'ceviklik': 2, 'zeka': 1 }, hp: 0 },
            "C√ºce": { stats: { 'fiziksel_guc': 1, 'dayaniklilik': 2 }, hp: 5 },
            "Yarƒ±-Elf": { stats: { 'karizma': 2, 'bilgelik': 1 }, hp: 0 },
            "Ejderha Soyu": { stats: { 'fiziksel_guc': 2, 'karizma': 1 }, hp: 5 },
            "Yarƒ±-Ork": { stats: { 'fiziksel_guc': 2, 'dayaniklilik': 1 }, hp: 10 },
            "Gnome": { stats: { 'zeka': 2, 'ceviklik': 1 }, hp: 0 },
            "Bu√ßukluk": { stats: { 'ceviklik': 2, 'karizma': 1 }, hp: 0 },
            "Tiefling": { stats: { 'zeka': 1, 'karizma': 2 }, hp: 0 }
        };

        // S√ñZDƒ∞Zƒ∞Mƒ∞ HATASI Gƒ∞DERƒ∞LDƒ∞
        const CLASS_PRIORITIES = {
            "Barbarian (Barbar)": "fiziksel_guc",
            "Fighter (Sava≈ü√ßƒ±)": "fiziksel_guc",
            "Paladin (Paladin)": "karizma",
            "Cleric (Ruhban)": "bilgelik",
            "Monk (Ke≈üi≈ü)": "ceviklik",
            "Ranger (Bek√ßi)": "ceviklik",
            "Rogue (Hƒ±rsƒ±z)": "ceviklik",
            "Bard (Ozan)": "karizma",
            "Druid (Druid)": "bilgelik",
            "Warlock (B√ºy√ºc√º)": "karizma",
            "Sorcerer (B√ºy√ºc√º)": "karizma",
            "Wizard (B√ºy√ºc√º)": "zeka"
        };

        const ALL_STATS_KEYS = ['fiziksel_guc', 'dayaniklilik', 'bilgelik', 'ceviklik', 'zeka', 'karizma'];

        const RANK_SETTINGS = {
            bronz: { label: 'Bronz', diceBonus: 0, hpBonus: 0, abilitySlots: 2 },
            gumus: { label: 'G√ºm√º≈ü', diceBonus: 1, hpBonus: 20, abilitySlots: 3 },
            altin: { label: 'Altƒ±n', diceBonus: 2, hpBonus: 40, abilitySlots: 4 },
            elmas: { label: 'Elmas', diceBonus: 3, hpBonus: 60, abilitySlots: 5 },
            platin: { label: 'Platin', diceBonus: 4, hpBonus: 80, abilitySlots: 6 }
        };
        const DEFAULT_RANK_KEY = 'bronz';

        // √áOKLU KAYIT ƒ∞√áƒ∞N YENƒ∞ ANAHTARLAR
        const LOCAL_STORAGE_KEY = 'frp_character_list';
        let currentCharacterName = '';
        let raceBonusAppliedState = {};
        ALL_STATS_KEYS.forEach(key => raceBonusAppliedState[key] = false);

        // ZAR GE√áMƒ∞≈ûƒ∞ SISTEMI
        let diceHistory = [];
        const MAX_HISTORY_ENTRIES = 10;


        // --- YARDIMCI FONKSƒ∞YONLAR ---

        function addDiceToHistory(diceType, result) {
            const now = new Date();
            const timeString = now.getHours().toString().padStart(2, '0') + ':' +
                now.getMinutes().toString().padStart(2, '0') + ':' +
                now.getSeconds().toString().padStart(2, '0');

            diceHistory.unshift({
                diceType: diceType,
                result: result,
                time: timeString
            });

            if (diceHistory.length > MAX_HISTORY_ENTRIES) {
                diceHistory.pop();
            }

            updateDiceHistoryDisplay();
        }

        function updateDiceHistoryDisplay() {
            const tbody = document.getElementById('diceHistoryBody');

            if (diceHistory.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 15px; color: var(--text-color);">Hen√ºz zar atƒ±lmadƒ±</td></tr>';
                return;
            }

            tbody.innerHTML = '';
            diceHistory.forEach((entry, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                <td>${index + 1}</td>
                <td>${entry.diceType}</td>
                <td>${entry.result}</td>
                <td>${entry.time}</td>
            `;
                tbody.appendChild(tr);
            });
        }

        function getCharacterList() {
            const listJson = localStorage.getItem(LOCAL_STORAGE_KEY);
            return listJson ? JSON.parse(listJson) : [];
        }

        function setCharacterList(list) {
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(list));
        }

        function getCharacterDataKey(name) {
            // ƒ∞simdeki bo≈üluklarƒ± ve k√º√ß√ºk harfleri kullanarak benzersiz bir anahtar olu≈üturur
            return `frp_char_${name.replace(/\s+/g, '_').toLowerCase()}`;
        }

        // --- EKRAN Y√ñNETƒ∞Mƒ∞ ---

        function showMainMenu() {
            document.getElementById('mainMenu').style.display = 'block';
            document.getElementById('characterSheetContainer').style.display = 'none';
            const importBtn = document.getElementById('importCharacterTopButton');
            if (importBtn) importBtn.style.display = 'flex';
            renderCharacterList();
        }

        function showCharacterSheet(isNew) {
            if (isNew) {
                // Yeni karakter olu≈üturuluyorsa, t√ºm alanlarƒ± temizle
                resetCharacterSheetData();
                currentCharacterName = '';
                // ƒ∞sim inputunu da temizle
                document.getElementById('isim').value = '';
            }

            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('characterSheetContainer').style.display = 'block';

            const importBtn = document.getElementById('importCharacterTopButton');
            if (importBtn) importBtn.style.display = 'none';

            updateCharacterSheet();
        }

        function showCharacterList() {
            showMainMenu();
        }

        function saveCurrentAndGoToMenu() {
            // Men√ºye d√∂nmeden √∂nce otomatik kaydetme
            saveCharacterData(true); // Parametre true: Geri d√∂n√ºld√ºƒü√º i√ßin kaydet
            showMainMenu();
        }

        // --- TEMƒ∞ZLEME/SIFIRLAMA ---

        function handleProfilePicUpload(input) {
            const file = input.files[0];
            if (file) {
                if (file.size > 20 * 1024 * 1024) { // 20MB limit
                    alert("L√ºtfen 20MB'dan k√º√ß√ºk bir resim se√ßiniz.");
                    return;
                }

                const reader = new FileReader();
                reader.onload = function (e) {
                    const display = document.getElementById('profilePicDisplay');
                    const placeholder = document.getElementById('profilePicPlaceholder');
                    display.src = e.target.result;
                    display.style.display = 'block';
                    placeholder.style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        }

        function resetCharacterSheetData() {
            const formElements = document.querySelectorAll('#characterSheetContainer input, #characterSheetContainer select, #characterSheetContainer textarea');
            formElements.forEach(element => {
                if (!element.id || element.id === 'hpValueInput') {
                    return;
                }

                if (element.type === 'checkbox') {
                    element.checked = false;
                } else if (element.tagName === 'SELECT') {
                    element.selectedIndex = 0;
                } else if (element.id.endsWith('_val')) {
                    element.value = ''; // Reset standard array
                } else {
                    element.value = '';
                }
            });

            // Reset Stats state
            statsLocked = false;
            enableStatDropdowns();
            populateStatDropdowns();
            statsLocked = false;
            enableStatDropdowns();
            populateStatDropdowns();
            document.getElementById('raceBonusWarning').style.display = 'block';
            document.getElementById('irk').disabled = false; // Re-enable race selection

            document.getElementById('can').value = '--- / ---';
            document.getElementById('diceResult').textContent = '---';

            ALL_STATS_KEYS.forEach(statKey => {
                document.getElementById(statKey + '_bonus').value = '+0';
                raceBonusAppliedState[statKey] = false;
            });
            clearPriorityStars();
            updateRaceBonusDisplay('');
            updateHPBar(0, 0);
            updateRankDependentFields();

            // Profil fotoƒürafƒ±nƒ± temizle
            const display = document.getElementById('profilePicDisplay');
            const placeholder = document.getElementById('profilePicPlaceholder');
            display.src = '';
            display.style.display = 'none';
            placeholder.style.display = 'flex';
        }

        // ISTATISTIK LOCK SYSTEM
        let statsLocked = false;
        const STANDARD_ARRAY = [15, 14, 13, 12, 10, 8];

        function populateStatDropdowns() {
            ALL_STATS_KEYS.forEach(key => {
                const select = document.getElementById(key + '_val');
                const currentValue = select.value;

                // Save current selection to restore if possible, or keep empty
                select.innerHTML = '<option value="">Se√ß</option>';

                STANDARD_ARRAY.forEach(val => {
                    const option = document.createElement('option');
                    option.value = val;
                    option.textContent = val;
                    select.appendChild(option);
                });

                // Restore value if it exists in array (for loading data)
                if (currentValue && STANDARD_ARRAY.includes(parseInt(currentValue))) {
                    select.value = currentValue;
                }
            });
            updateStatDropdowns();
        }

        function handleStatChange(changedKey) {
            updateStatDropdowns();
            calculateBonus(changedKey);

            // Check if all stats are selected
            const allSelected = ALL_STATS_KEYS.every(key => document.getElementById(key + '_val').value !== "");
            if (allSelected) {
                // User Requirement: Prompt to lock immediately after selection
                if (confirm("T√ºm istatistikleri belirlediniz. Bu daƒüƒ±lƒ±mƒ± onaylayƒ±p kilitlemek istiyor musunuz?\n\n(Dƒ∞KKAT: Onayladƒ±ktan sonra istatistik puanlarƒ±nƒ± deƒüi≈ütiremezsiniz, ancak Irk Bonuslarƒ±nƒ± ekleyebilirsiniz.)")) {
                    statsLocked = true;
                    disableStatDropdowns();
                    // Optionally save? Maybe not yet, just lock UI.
                }
            }
        }

        function updateStatDropdowns() {
            // Get all currently selected "effective base values"
            const usedBaseValues = {};
            ALL_STATS_KEYS.forEach(key => {
                const select = document.getElementById(key + '_val');
                const val = select.value;
                if (!val) return;

                // Check if the selected option has a special base value
                // (This happens when a race bonus modifies the value)
                const selectedOption = select.options[select.selectedIndex];
                const baseVal = selectedOption.getAttribute('data-base-value');

                if (baseVal) {
                    usedBaseValues[key] = parseInt(baseVal);
                } else {
                    usedBaseValues[key] = parseInt(val);
                }
            });

            // Update each dropdown
            ALL_STATS_KEYS.forEach(key => {
                const select = document.getElementById(key + '_val');
                // Don't mess with options if locked
                if (statsLocked) return;

                Array.from(select.options).forEach(option => {
                    if (!option.value) return; // Skip default option

                    // Logic: Is this option's value (or its base value) used by any *other* key?
                    // Note: standard options don't have data-base-value, so we check checks against values directly for now.
                    // But correctly we should check if THIS option's value (which is a standard array val) is in usedBaseValues

                    const optVal = parseInt(option.value);

                    // Does any other stat use this Standard Array value?
                    const isUsed = Object.entries(usedBaseValues).some(([k, v]) => k !== key && v === optVal);

                    if (isUsed) {
                        option.disabled = true;
                    } else {
                        option.disabled = false;
                    }
                });
            });
        }

        // --- MEVCUT Dƒ∞ƒûER FONKSƒ∞YONLAR ---
        // (populateDropdowns call needs to be hooked up or called on load)

        // --- CRUD ƒ∞≈ûLEMLERƒ∞ ---

        // Kaydetme fonksiyonu g√ºncellendi (Artƒ±k men√ºye d√∂nerken otomatik kaydediyor)
        function saveCharacterData(isAutoSave = false) {
            const name = document.getElementById('isim').value.trim();
            if (!name) {
                if (!isAutoSave) {
                    alert("L√ºtfen karakterinize bir isim verin.");
                }
                return;
            }

            // Lock stats on first save
            if (!statsLocked && !isAutoSave) {
                // Only lock if all stats are selected? Or just lock whatever is there?
                // User requirement: "karakter bir kere kaydediltikten sonrada istatistikler deƒüi≈üilmeyecek"
                // So we lock it.
                if (confirm("Karakteri kaydettikten sonra istatistik puanlarƒ± (Standard Array) deƒüi≈ütirilemez. Onaylƒ±yor musunuz?")) {
                    statsLocked = true;
                    disableStatDropdowns();
                } else {
                    return; // Cancel save
                }
            } else if (!statsLocked && isAutoSave) {
                // Auto-save shouldn't lock automatically, maybe? 
                // But user said "once saved". Let's assume explicit save locks it.
                // For auto-save (e.g. returning to menu), we usually don't prompt. 
                // Let's NOT lock on auto-save to be safe, unless already locked.
            }

            const characterData = {};
            const formElements = document.querySelectorAll('#characterSheetContainer input, #characterSheetContainer select, #characterSheetContainer textarea');

            formElements.forEach(element => {
                if (element.id && element.id !== 'hpValueInput') {
                    if (element.type === 'checkbox') {
                        characterData[element.id] = element.checked;
                    } else {
                        characterData[element.id] = element.value;
                    }
                }
            });
            characterData['raceBonusAppliedState'] = raceBonusAppliedState;
            characterData['statsLocked'] = statsLocked; // Save lock state

            // Profil fotoƒürafƒ±nƒ± kaydet
            const profilePic = document.getElementById('profilePicDisplay').src;
            if (profilePic && profilePic.startsWith('data:image')) {
                characterData['profilFoto'] = profilePic;
            }

            const dataKey = getCharacterDataKey(name);

            try {
                // Ana Listeyi G√ºncelle
                let list = getCharacterList();
                if (!list.includes(name)) {
                    list.push(name);
                    setCharacterList(list);
                }

                // Karakter Verisini Kaydet
                localStorage.setItem(dataKey, JSON.stringify(characterData));
                currentCharacterName = name;

                updateCharacterSheet();
                if (!isAutoSave) {
                    alert(`Karakter "${name}" ba≈üarƒ±yla kaydedildi!`);
                }

            } catch (e) {
                console.error("Karakter verileri kaydedilemedi:", e);
                if (!isAutoSave) {
                    alert("Kaydetme hatasƒ±! Tarayƒ±cƒ±nƒ±zƒ±n yerel depolama alanƒ± dolu veya devre dƒ±≈üƒ±.");
                }
            }
        }

        function loadCharacter(name) {
            const dataKey = getCharacterDataKey(name);
            try {
                const storedData = localStorage.getItem(dataKey);
                if (!storedData) {
                    alert("Kayƒ±tlƒ± karakter verisi bulunamadƒ±.");
                    return;
                }

                const characterData = JSON.parse(storedData);

                if (characterData.statsLocked !== undefined) {
                    statsLocked = characterData.statsLocked;
                } else {
                    statsLocked = false;
                }

                if (characterData.raceBonusAppliedState) {
                    raceBonusAppliedState = characterData.raceBonusAppliedState;
                } else {
                    ALL_STATS_KEYS.forEach(key => raceBonusAppliedState[key] = false);
                }

                // Restore Race Bonus Warning Visibility & Lock Race Dropdown
                const raceBonusWarning = document.getElementById('raceBonusWarning');
                const hasBonuses = Object.values(raceBonusAppliedState).some(val => val === true);

                if (hasBonuses) {
                    raceBonusWarning.style.display = 'none';
                    // Lock race selection if any bonus applied
                    document.getElementById('irk').disabled = true;
                } else {
                    raceBonusWarning.style.display = 'block';
                    document.getElementById('irk').disabled = false;
                }

                // Populate dropdowns properly
                populateStatDropdowns();

                const abilityPoolData = {};
                for (const id in characterData) {
                    if (id.startsWith('abilityPool')) {
                        abilityPoolData[id] = characterData[id];
                        continue;
                    }

                    if (id === 'profilFoto') {
                        const display = document.getElementById('profilePicDisplay');
                        const placeholder = document.getElementById('profilePicPlaceholder');
                        if (characterData[id]) {
                            display.src = characterData[id];
                            display.style.display = 'block';
                            placeholder.style.display = 'none';
                        } else {
                            display.src = '';
                            display.style.display = 'none';
                            placeholder.style.display = 'flex';
                        }
                        continue;
                    }

                    const element = document.getElementById(id);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = !!characterData[id];
                        } else if (element.type !== 'file') { // Dosya inputlarƒ±na deƒüer atanamaz (G√ºvenlik)
                            element.value = characterData[id];
                        }
                    }
                }

                // Refresh dropdowns after value set
                updateStatDropdowns();

                // Apply Lock state
                if (statsLocked) {
                    disableStatDropdowns();
                } else {
                    enableStatDropdowns();
                }

                // FIX: Reconstruct custom options for Boosted Stats (Race Bonuses)
                ALL_STATS_KEYS.forEach(key => {
                    // Try to retrieve the value from data even if dropdown didn't accept it
                    const savedVal = characterData[key + '_val']; // might be "15_race" or "15" or "8"
                    const select = document.getElementById(key + '_val');

                    if (!savedVal) return;

                    // Logic to detect if it's a boosted value
                    // 1. If it has "_race" suffix
                    // 2. Or if select.value is empty (legacy handling for old saves?)

                    const isRaceValue = typeof savedVal === 'string' && savedVal.endsWith('_race');

                    if (isRaceValue || (select.value !== savedVal && !STANDARD_ARRAY.includes(parseInt(savedVal)))) {

                        const selectedRace = document.getElementById('irk').value;
                        const bonuses = RACE_STAT_BONUSES[selectedRace]?.stats || {};
                        const bonus = bonuses[key] || 0;

                        if (bonus !== 0) {
                            const valInt = parseInt(savedVal);
                            const inferredBase = valInt - bonus;

                            if (STANDARD_ARRAY.includes(inferredBase)) {
                                // Re-create the custom option
                                // Use the exact saved value string if it ends with _race, otherwise convert to new format?
                                // Let's stick to saved value to be safe.

                                const newOption = document.createElement('option');
                                newOption.value = savedVal; // e.g. "15_race"
                                const sign = bonus >= 0 ? '+' : '';
                                newOption.textContent = `${valInt} (${inferredBase} ${sign}${bonus} Irk)`;
                                newOption.setAttribute('data-base-value', inferredBase);
                                select.appendChild(newOption);
                                select.value = savedVal;
                            }
                        }
                    } else if (select.value !== savedVal) {
                        // Standard values that failed to select? Rare fallback
                        select.value = savedVal;
                    }
                });


                currentCharacterName = name;
                showCharacterSheet(false);
                restoreAbilityPoolState(abilityPoolData);
                updateCharacterSheet();

            } catch (e) {
                console.error("Karakter verileri y√ºklenemedi:", e);
                alert("Y√ºkleme hatasƒ±: " + e.message + "\n(Kayƒ±t dosyasƒ± bozuk olabilir veya veri yapƒ±sƒ± uyumsuz.)");
            }
        }

        function disableStatDropdowns() {
            ALL_STATS_KEYS.forEach(key => {
                document.getElementById(key + '_val').disabled = true;
            });
        }

        function enableStatDropdowns() {
            ALL_STATS_KEYS.forEach(key => {
                document.getElementById(key + '_val').disabled = false;
            });
        }

        function restoreAbilityPoolState(savedSlots = {}) {
            Object.entries(savedSlots).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (!element) {
                    return;
                }

                if (element.type === 'checkbox') {
                    element.checked = Boolean(value);
                } else {
                    element.value = value ?? '';
                }
            });
        }

        function deleteCharacter(name) {
            if (!confirm(`Karakter "${name}" kalƒ±cƒ± olarak silinecektir. Emin misiniz?`)) {
                return;
            }

            const dataKey = getCharacterDataKey(name);

            // Ana Listeden Sil
            let list = getCharacterList();
            list = list.filter(item => item !== name);
            setCharacterList(list);

            // Karakter Verisini Sil
            localStorage.removeItem(dataKey);

            // Eƒüer silinen, ≈üu anda a√ßƒ±k olan karakterse, sƒ±fƒ±rla
            if (currentCharacterName === name) {
                currentCharacterName = '';
                resetCharacterSheetData();
            }

            alert(`Karakter "${name}" ba≈üarƒ±yla silindi.`);
            renderCharacterList();
        }

        function renderCharacterList() {
            const charListElement = document.getElementById('charList');
            charListElement.innerHTML = '';
            const list = getCharacterList();

            if (list.length === 0) {
                charListElement.innerHTML = '<p style="text-align: center; color: var(--header-color); padding: 20px; border: 1px dashed var(--divider-color); border-radius: 6px;">Kayƒ±tlƒ± karakter bulunmamaktadƒ±r.</p>';
                return;
            }

            list.forEach(name => {
                const listItem = document.createElement('li');
                listItem.classList.add('char-list-item');

                listItem.innerHTML = `
                <span>${name}</span>
                <div style="display: flex; gap: 5px;">
                    <button class="load-btn" onclick="loadCharacter('${name}')" style="width: 70px;">Y√úKLE</button>
                    <button class="btn-success" onclick="exportCharacter('${name}')" style="width: 70px; font-size: 0.9em; padding: 6px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; color: white;">AKTAR</button>
                    <button class="delete-btn" onclick="deleteCharacter('${name}')" style="width: 70px;">Sƒ∞L</button>
                </div>
            `;
                charListElement.appendChild(listItem);
            });
        }

        // --- MEVCUT Dƒ∞ƒûER FONKSƒ∞YONLAR ---

        function toggleDarkMode() {
            const body = document.body;
            const toggleButton = document.getElementById('darkModeToggle');
            body.classList.toggle('dark-mode');

            if (body.classList.contains('dark-mode')) {
                toggleButton.textContent = '‚òÄÔ∏è G√ºnd√ºz Modu A√ß';
                localStorage.setItem('darkMode', 'enabled');
            } else {
                toggleButton.textContent = 'üåô Gece Modu A√ß';
                localStorage.setItem('darkMode', 'disabled');
            }
        }

        function populateDropdowns() {
            const sinifSelect = document.getElementById('sinif');
            const irkSelect = document.getElementById('irk');

            Object.keys(CLASS_HP).forEach(sinif => {
                const option = document.createElement('option');
                option.value = sinif;
                option.textContent = sinif;
                sinifSelect.appendChild(option);
            });

            Object.keys(RACE_STAT_BONUSES).forEach(irk => {
                const option = document.createElement('option');
                option.value = irk;
                option.textContent = irk;
                irkSelect.appendChild(option);
            });
        }

        function updateRaceBonusDisplay(selectedRace) {
            ALL_STATS_KEYS.forEach(statKey => {
                const displaySpan = document.getElementById(statKey + '_race_bonus');
                if (displaySpan) {
                    displaySpan.textContent = '';
                }
            });

            const bonuses = RACE_STAT_BONUSES[selectedRace]?.stats || {};

            for (const [statKey, bonusAmount] of Object.entries(bonuses)) {
                const displaySpan = document.getElementById(statKey + '_race_bonus');

                if (displaySpan && !raceBonusAppliedState[statKey]) {
                    const sign = bonusAmount >= 0 ? '+' : '';
                    displaySpan.textContent = ` (${sign}${bonusAmount} Irk Bonusu)`;
                }
            }
        }

        function applyRaceBonus(targetStat) {
            if (statsLocked) {
                alert("Karakter kaydedildiƒüi i√ßin istatistikler kilitlenmi≈ütir.");
                return;
            }

            const selectedRace = document.getElementById('irk').value;
            if (!selectedRace) {
                alert("L√ºtfen √∂nce bir ƒ±rk se√ßin.");
                return;
            }

            const bonuses = RACE_STAT_BONUSES[selectedRace]?.stats || {};
            const bonusAmount = bonuses[targetStat];

            if (!bonusAmount) {
                alert(`${selectedRace} ƒ±rkƒ± ${targetStat.replace('_', ' ').toUpperCase()} i√ßin bir bonus saƒülamƒ±yor.`);
                return;
            }

            if (raceBonusAppliedState[targetStat]) {
                alert("Bu istatistik i√ßin ƒ±rk bonusu zaten eklendi!");
                return;
            }

            // Apply bonus logic:
            raceBonusAppliedState[targetStat] = true;
            updateRaceBonusDisplay(selectedRace);
            updateCharacterSheet(); // Recalculate everything

            // Hide warning if ANY bonus is applied? Or all applicable?
            // "bir kere ekledikten sonra" -> Muhtemelen en az bir tane eklenince.
            document.getElementById('raceBonusWarning').style.display = 'none';
        }

        function calculateBonus(statKey) {
            const valInput = document.getElementById(statKey + '_val');
            let baseVal = parseInt(valInput.value) || 10;

            // Add race bonus if applied
            const selectedRace = document.getElementById('irk')?.value;
            if (selectedRace && raceBonusAppliedState[statKey]) {
                const bonuses = RACE_STAT_BONUSES[selectedRace]?.stats || {};
                baseVal += (bonuses[statKey] || 0);
            }

            const bonus = Math.floor((baseVal - 10) / 2);
            const sign = bonus >= 0 ? '+' : '';
            document.getElementById(statKey + '_bonus').value = sign + bonus;
        }

        function clearPriorityStars() {
            const allLabels = document.querySelectorAll('label');
            allLabels.forEach(label => {
                const star = label.querySelector('.priority-star');
                if (star) {
                    star.remove();
                }
            });
        }

        function getRankConfig(rankKey) {
            return RANK_SETTINGS[rankKey] || RANK_SETTINGS[DEFAULT_RANK_KEY];
        }

        function getRankDiceBonus() {
            const rankValue = document.getElementById('rutbe')?.value;
            return getRankConfig(rankValue).diceBonus;
        }

        function updateRankDependentFields() {
            const rankValue = document.getElementById('rutbe')?.value;
            const config = getRankConfig(rankValue);
            const bonusLabel = document.getElementById('rankDiceBonusLabel');
            if (bonusLabel) {
                bonusLabel.textContent = `${config.label} r√ºtbesi t√ºm zaralara +${config.diceBonus} bonus verir, karaktere +${config.hpBonus} HP ekler ve ${config.abilitySlots} yetenek slotu sunar.`;
            }
            updateAbilityPoolSlots(config.abilitySlots);
            updateAbilityTextAreaRows(config.abilitySlots);
        }

        function updateAbilityPoolSlots(slotCount) {
            const container = document.getElementById('abilityPoolSlots');
            if (!container) return;

            const previousStates = Array.from(container.querySelectorAll('.ability-slot input[type="checkbox"]')).map(cb => cb.checked);

            container.innerHTML = '';

            for (let i = 0; i < slotCount; i++) {
                const slotWrapper = document.createElement('div');
                slotWrapper.className = 'ability-slot';

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `abilityPoolActive-${i + 1}`;
                checkbox.name = checkbox.id;
                checkbox.checked = !!previousStates[i];

                const label = document.createElement('label');
                label.className = 'ability-slot-label';
                label.setAttribute('for', checkbox.id);
                label.textContent = `Slot ${i + 1}`;
                slotWrapper.appendChild(checkbox);
                slotWrapper.appendChild(label);
                container.appendChild(slotWrapper);
            }
        }

        function updateAbilityTextAreaRows(slotCount) {
            const textarea = document.getElementById('yetenekler');
            if (!textarea) {
                return;
            }

            const baseRows = 6;
            const computedRows = Math.min(12, baseRows + slotCount);
            textarea.rows = computedRows;
        }

        function addPriorityStars(priorities) {
            clearPriorityStars();

            // Birincil istatistikleri i≈üaretle
            priorities.forEach(statName => {
                // statName √∂rneƒüin: "Fƒ∞Zƒ∞KSEL G√ú√á"
                const allLabels = document.querySelectorAll('.stat-group.three-col label');
                allLabels.forEach(label => {
                    // Label i√ßeriƒüini al (span hari√ß)
                    let labelContent = '';
                    Array.from(label.childNodes).forEach(node => {
                        if (node.nodeType === 3) { // Text node
                            labelContent += node.textContent;
                        }
                    });
                    labelContent = labelContent.trim();

                    // Eƒüer label'ƒ±n i√ßeriƒüi statName ile e≈üle≈üiyorsa yƒ±ldƒ±z ekle
                    if (labelContent === statName) {
                        if (!label.querySelector('.priority-star')) {
                            const star = document.createElement('span');
                            star.textContent = ' *';
                            star.classList.add('priority-star');
                            label.appendChild(star);
                        }
                    }
                });
            });
        }

        function updateHPBar(currentHP, maxHP) {
            const hpBar = document.getElementById('hpBar');
            if (!hpBar || maxHP === 0) {
                if (hpBar) hpBar.style.width = '0%';
                return;
            }

            let percent = (currentHP / maxHP) * 100;
            percent = Math.max(0, Math.min(100, percent));

            hpBar.style.width = `${percent}%`;

            if (percent > 50) {
                hpBar.style.backgroundColor = '#4CAF50';
            } else if (percent > 20) {
                hpBar.style.backgroundColor = '#ffc107';
            } else {
                hpBar.style.backgroundColor = '#d93025';
            }
        }

        function updateSkillTableBonuses() {
            const tableRows = document.querySelectorAll('#skillReferenceTable tbody tr');

            tableRows.forEach(row => {
                const statKey = row.getAttribute('data-stat-key');
                const bonusCell = row.querySelector('.skill-bonus');
                const bonusInput = document.getElementById(statKey + '_bonus');

                if (bonusInput && bonusCell) {
                    bonusCell.textContent = bonusInput.value;
                }
            });
        }

        function applyRaceBonus(statKey) {
            // FIX: User requested Race Bonuses ONLY be allowed when stats are locked.
            if (!statsLocked) {
                alert("Irk bonusu ekleyebilmek i√ßin √∂nce t√ºm ƒ∞statistik Puanlarƒ±nƒ± (Standard Array) belirleyip kilitlemeniz gerekmektedir.");
                return;
            }

            const valueInput = document.getElementById(statKey + '_val');
            // FIX: Check if a value is selected first
            if (!valueInput.value) {
                alert("L√ºtfen √∂nce bu istatistik i√ßin bir deƒüer (Standard Array) se√ßin.");
                return;
            }

            const bonusSpan = document.getElementById(statKey + '_race_bonus');
            const bonusText = bonusSpan.textContent;

            // Logic to find bonus amount from Span OR from Config directly
            let bonusAmount = 0;

            // It's safer to get from config again to be sure
            const selectedRace = document.getElementById('irk').value;
            const bonuses = RACE_STAT_BONUSES[selectedRace]?.stats || {};
            bonusAmount = bonuses[statKey];

            if (!bonusAmount) {
                alert("Bu istatistik i√ßin uygulanacak bir ƒ±rk bonusu bulunamadƒ±.");
                return;
            }

            if (raceBonusAppliedState[statKey]) {
                alert("Bu istatistik i√ßin ƒ±rk bonusu zaten eklendi!");
                return;
            }

            const originalValue = parseInt(valueInput.value);
            const newValue = originalValue + bonusAmount;

            // Strategy: Always create a custom option with a unique value suffix to avoid selecting the standard option.
            const uniqueValue = `${newValue}_race`;

            // Check if THIS specific custom option exists (idempotency)
            let optionExists = false;
            for (let i = 0; i < valueInput.options.length; i++) {
                if (valueInput.options[i].value === uniqueValue) {
                    optionExists = true;
                    break;
                }
            }

            if (!optionExists) {
                // Create new option
                const newOption = document.createElement('option');
                newOption.value = uniqueValue; // "15_race"
                const sign = bonusAmount >= 0 ? '+' : '';
                newOption.textContent = `${newValue} (${originalValue} ${sign}${bonusAmount} Irk)`;
                newOption.setAttribute('data-base-value', originalValue); // Tag with base value for mutual exclusion
                valueInput.appendChild(newOption);
            }

            valueInput.value = uniqueValue;

            calculateBonus(statKey);

            bonusSpan.textContent = ''; // Hide the +2 text since it's now applied
            raceBonusAppliedState[statKey] = true;

            // Force update to refresh disabled states
            updateStatDropdowns();
            updateCharacterSheet();

            alert(`${statKey.replace('_', ' ').toUpperCase()} istatistiƒüine ${bonusAmount > 0 ? '+' : ''}${bonusAmount} ƒ±rk bonusu ba≈üarƒ±yla eklendi!`);

            // Hide global warning if needed
            document.getElementById('raceBonusWarning').style.display = 'none';

            // FIX: Lock the Race Dropdown to prevent inconsistent state
            document.getElementById('irk').disabled = true;
        }

        function updateCharacterSheet() {
            const selectedClass = document.getElementById('sinif').value;
            const selectedRace = document.getElementById('irk').value;
            const canInput = document.getElementById('can');

            let maxHP = 0;
            let hpBonus = 0;

            if (selectedClass) {
                maxHP = CLASS_HP[selectedClass] || 0;
            }

            if (selectedRace && RACE_STAT_BONUSES[selectedRace]) {
                hpBonus = RACE_STAT_BONUSES[selectedRace].hp || 0;

                // Irk HP bonusu ekle
                maxHP += hpBonus;
            }

            // R√ºtbe kaynaklƒ± HP bonusu (Bronz: +0, sonraki her r√ºtbe +10 HP)
            const rankValue = document.getElementById('rutbe')?.value;
            const rankHpBonus = getRankConfig(rankValue).hpBonus || 0;
            maxHP += rankHpBonus;

            // Dayanƒ±klƒ±lƒ±k (Con) modifikator√º ba≈üƒ±na +10 HP ekle
            const conVal = parseInt(document.getElementById('dayaniklilik_val')?.value) || 0;
            const conMod = Math.floor((conVal - 10) / 2);
            const hpFromCon = Math.max(0, conMod * 10);
            maxHP += hpFromCon;

            let finalCurrentHP = 0;
            if (maxHP > 0) {
                const hpParts = canInput.value.split('/');
                let currentHP = 0;

                if (hpParts.length === 2) {
                    currentHP = parseInt(hpParts[0].trim()) || 0;
                } else {
                    currentHP = maxHP;
                }

                finalCurrentHP = Math.min(currentHP, maxHP);

                canInput.value = `${finalCurrentHP} / ${maxHP} HP`;
            } else {
                canInput.value = '--- / ---';
            }

            updateHPBar(finalCurrentHP, maxHP);

            if (selectedClass && CLASS_PRIORITIES[selectedClass]) {
                // Stat anahtarƒ±nƒ± T√ºrk√ße ada √ßevir
                const STAT_NAME_MAP = {
                    "fiziksel_guc": "Fƒ∞Zƒ∞KSEL G√ú√á",
                    "dayaniklilik": "DAYANIKLILIK",
                    "bilgelik": "Bƒ∞LGELƒ∞K",
                    "ceviklik": "√áEVƒ∞KLƒ∞K",
                    "zeka": "ZEKA",
                    "karizma": "KARƒ∞ZMA"
                };
                const primaryStatName = STAT_NAME_MAP[CLASS_PRIORITIES[selectedClass]];
                addPriorityStars([primaryStatName]);
            } else {
                clearPriorityStars();
            }

            updateRaceBonusDisplay(selectedRace);

            ALL_STATS_KEYS.forEach(statKey => {
                calculateBonus(statKey);
            });

            updateRankDependentFields();
        }

        function calculateBonus(statName) {
            const valueInput = document.getElementById(statName + '_val');
            const bonusInput = document.getElementById(statName + '_bonus');

            let statValue = parseInt(valueInput.value) || 0;
            const finalStatValue = statValue;

            let bonus = Math.floor((finalStatValue - 10) / 2);

            let bonusDisplay = bonus >= 0 ? '+' + bonus : String(bonus);
            bonusInput.value = bonusDisplay;

            updateSkillTableBonuses();
        }

        function rollSkillCheck(statKey, skillName) {
            const bonusInput = document.getElementById(statKey + '_bonus');
            const modal = document.getElementById('rollModal');
            const modalResult = document.getElementById('modalResult');
            const modalTitle = document.getElementById('modalTitle');
            const rollDuration = 1000;

            const bonusText = bonusInput ? bonusInput.value : '0';
            const bonus = parseInt(bonusText) || 0;
            const rankBonus = getRankDiceBonus();
            const totalBonus = bonus + rankBonus;

            modal.style.display = 'flex';
            modalTitle.textContent = `${skillName} Yetenek Kontrol√º`;

            modalResult.classList.add('modal-rolling');
            modalResult.textContent = 'Zar Atƒ±lƒ±yor...';
            modalResult.style.color = 'white';
            modalResult.style.backgroundColor = 'transparent';

            const animationInterval = setInterval(() => {
                modalResult.textContent = Math.floor(Math.random() * 20) + 1;
            }, 50);

            setTimeout(() => {
                clearInterval(animationInterval);

                const d20Roll = Math.floor(Math.random() * 20) + 1;
                const totalResult = d20Roll + totalBonus;

                modalResult.classList.remove('modal-rolling');

                // STAT_MAP'i bu fonksiyonda manuel olarak tekrar tanƒ±mlƒ±yoruz
                const STAT_MAP_REVERSE = {
                    "fiziksel_guc": "Fƒ∞Zƒ∞KSEL G√ú√á",
                    "dayaniklilik": "DAYANIKLILIK",
                    "bilgelik": "Bƒ∞LGELƒ∞K",
                    "ceviklik": "√áEVƒ∞KLƒ∞K",
                    "zeka": "ZEKA",
                    "karizma": "KARƒ∞ZMA"
                };
                const statNameTR = STAT_MAP_REVERSE[statKey];

                let breakdown = `(Zar: ${d20Roll} ${bonus >= 0 ? '+' : ''}${bonus} ${statNameTR} Bonusu ${rankBonus >= 0 ? '+' : ''}${rankBonus} R√ºtbe Bonusu)`;
                modalTitle.textContent = `${skillName}: ${breakdown}`;

                if (d20Roll === 20) {
                    modalResult.style.color = '#76ff03';
                    modalResult.textContent = `KRƒ∞Tƒ∞K BA≈ûARI! (${totalResult})`;
                } else if (d20Roll === 1) {
                    modalResult.style.color = '#ff1744';
                    modalResult.textContent = `KRƒ∞Tƒ∞K HATA! (${totalResult})`;
                } else {
                    modalResult.style.color = 'white';
                    modalResult.textContent = totalResult;
                }

                document.getElementById('diceResult').textContent = `Son Yetenek Kontrol√º: ${totalResult}`;
                addDiceToHistory(`${skillName} (D20)`, totalResult);

            }, rollDuration);
        }

        function rollBaseAttack() {
            const selectedClass = document.getElementById('sinif').value;

            if (!selectedClass || selectedClass === "") {
                alert("L√ºtfen √∂nce karakterin sƒ±nƒ±fƒ±nƒ± se√ßin.");
                return;
            }

            // CLASS_PRIORITIES'teki deƒüer artƒ±k direkt stat anahtarƒ±
            const primaryStatKey = CLASS_PRIORITIES[selectedClass];

            if (!primaryStatKey) {
                alert("Se√ßilen sƒ±nƒ±f i√ßin tanƒ±mlanmƒ±≈ü bir Birincil ƒ∞statistik bulunamadƒ±.");
                return;
            }

            // Stat anahtarƒ±nƒ± T√ºrk√ße ada √ßevir
            const STAT_NAME_MAP = {
                "fiziksel_guc": "Fƒ∞Zƒ∞KSEL G√ú√á",
                "dayaniklilik": "DAYANIKLILIK",
                "bilgelik": "Bƒ∞LGELƒ∞K",
                "ceviklik": "√áEVƒ∞KLƒ∞K",
                "zeka": "ZEKA",
                "karizma": "KARƒ∞ZMA"
            };
            const primaryStatTR = STAT_NAME_MAP[primaryStatKey];

            const bonusInput = document.getElementById(primaryStatKey + '_bonus');
            const statBonus = parseInt(bonusInput ? bonusInput.value : 0) || 0;
            const rankBonus = getRankDiceBonus();

            const modal = document.getElementById('rollModal');
            const modalResult = document.getElementById('modalResult');
            const modalTitle = document.getElementById('modalTitle');
            const rollDuration = 1000;

            // Zar atma √∂ncesinde hesapla
            const d6Rolls = [];
            for (let i = 0; i < 3; i++) {
                d6Rolls.push(Math.floor(Math.random() * 6) + 1);
            }
            const totalRoll = d6Rolls.reduce((a, b) => a + b, 0);
            const totalDamage = totalRoll + statBonus;

            modal.style.display = 'flex';
            modalTitle.textContent = `Temel Saldƒ±rƒ± (3D6 + ${primaryStatTR})`;

            modalResult.classList.add('modal-rolling');
            modalResult.textContent = 'Hasar Hesaplanƒ±yor...';
            modalResult.style.color = 'white';
            modalResult.style.backgroundColor = 'transparent';

            const animationInterval = setInterval(() => {
                // Animasyon sƒ±rasƒ±nda rastgele toplam g√∂ster
                modalResult.textContent = Math.floor(Math.random() * 18) + 1 + statBonus;
            }, 50);

            setTimeout(() => {
                clearInterval(animationInterval);

                modalResult.classList.remove('modal-rolling');

                const breakdown = `(${d6Rolls.join(' + ')} Zar  ${statBonus >= 0 ? '+' : ''}${statBonus} ${primaryStatTR} BONUSU)`;

                modalTitle.textContent = `Temel Hasar: ${breakdown}`;
                modalResult.textContent = totalDamage;
                modalResult.style.color = '#fffae6';
                modalResult.style.backgroundColor = '#d93025';

                document.getElementById('diceResult').textContent = `Son Saldƒ±rƒ± Hasarƒ±: ${totalDamage}`;
                addDiceToHistory('Temel Saldƒ±rƒ± (3D6)', totalDamage);

            }, rollDuration);
        }

        function rollMultipleDice(sides) {
            const countInput = document.getElementById(`diceCount-${sides}`);
            const count = Math.max(1, parseInt(countInput?.value) || 1);
            const rolls = [];
            for (let i = 0; i < count; i++) {
                rolls.push(Math.floor(Math.random() * sides) + 1);
            }

            const totalRoll = rolls.reduce((acc, curr) => acc + curr, 0);
            const rankBonus = getRankDiceBonus();
            const totalResult = totalRoll + rankBonus;

            const modal = document.getElementById('rollModal');
            const modalResult = document.getElementById('modalResult');
            const modalTitle = document.getElementById('modalTitle');
            const rollDuration = 1000;

            modal.style.display = 'flex';
            modalTitle.textContent = `D${sides} x${count} Atƒ±≈üƒ±`;

            modalResult.classList.add('modal-rolling');
            modalResult.textContent = 'Zar Atƒ±lƒ±yor...';
            modalResult.style.color = 'white';
            modalResult.style.backgroundColor = 'transparent';

            const animationInterval = setInterval(() => {
                modalResult.textContent = Math.floor(Math.random() * sides) + 1;
            }, 50);

            setTimeout(() => {
                clearInterval(animationInterval);
                modalResult.classList.remove('modal-rolling');

                const rankBonusLabel = rankBonus >= 0 ? `+${rankBonus}` : `${rankBonus}`;
                const breakdown = `(${rolls.join(' + ')} Zar + ${rankBonusLabel} R√ºtbe Bonusu)`;
                modalTitle.textContent = `Toplam: ${breakdown}`;
                modalResult.textContent = totalResult;
                modalResult.style.color = '#ffc107';
                modalResult.style.backgroundColor = '#222';
                document.getElementById('diceResult').textContent = `Son D${sides} Atƒ±≈üƒ±: ${totalResult}`;
                addDiceToHistory(`D${sides} x${count}`, totalResult);

            }, rollDuration);
        }

        function updateHP(amount, operation) {
            const canInput = document.getElementById('can');
            const valueInput = document.getElementById('hpValueInput');

            let amountToChange = parseInt(valueInput.value) || 0;

            const hpParts = canInput.value.split('/');
            let currentHP = parseInt(hpParts[0].trim()) || 0;
            const maxHP = parseInt(hpParts[1].trim()) || 0;

            if (maxHP === 0) {
                alert("√ñnce sƒ±nƒ±f ve ƒ±rk se√ßerek Maksimum Canƒ± (Max HP) belirleyin.");
                return;
            }

            if ((operation === 'damage' || operation === 'heal') && amountToChange === 0) {
                alert("L√ºtfen Hasar/ƒ∞yile≈ütirme i√ßin bir deƒüer girin.");
                return;
            }

            if (operation === 'damage') {
                currentHP = Math.max(0, currentHP - amountToChange);
            } else if (operation === 'heal') {
                currentHP = Math.min(maxHP, currentHP + amountToChange);
            } else if (operation === 'shortRest') {
                const healAmount = Math.ceil(maxHP / 2);
                currentHP = Math.min(maxHP, currentHP + healAmount);
                alert(`Kƒ±sa Dinlenme: ${healAmount} HP iyile≈ütirildi.`);
            } else if (operation === 'longRest') {
                currentHP = maxHP;
                alert("Uzun Dinlenme: Can tam olarak yenilendi.");
            }

            canInput.value = `${currentHP} / ${maxHP} HP`;
            updateHPBar(currentHP, maxHP);

            if (operation === 'damage' || operation === 'heal') {
                valueInput.value = '';
            }
        }

        // --- BA≈ûLANGI√á Y√úKLEME VE EVENT LISTENER'LAR ---

        window.onload = function () {
            populateDropdowns();
            populateStatDropdowns(); // Initialize stat dropdowns
            renderCharacterList();

            // Check for saved dark mode preference
            if (localStorage.getItem('darkMode') === 'enabled') {
                document.body.classList.add('dark-mode');
                document.getElementById('darkModeToggle').textContent = '‚òÄÔ∏è G√ºnd√ºz Modu A√ß';
            }

            updateRankDependentFields();

            // Uygulama her zaman Ana Men√º ile ba≈ülar
            showMainMenu();
        };

        document.getElementById('damageButton').addEventListener('click', () => updateHP(0, 'damage'));
        document.getElementById('healButton').addEventListener('click', () => updateHP(0, 'heal'));
        document.getElementById('shortRestButton').addEventListener('click', () => updateHP(0, 'shortRest'));
        document.getElementById('longRestButton').addEventListener('click', () => updateHP(0, 'longRest'));
        const rankSelect = document.getElementById('rutbe');
        if (rankSelect) {
            // When rank changes, update dependent fields AND recalculate the character sheet (HP etc.)
            rankSelect.addEventListener('change', function () { updateRankDependentFields(); updateCharacterSheet(); });
        }

        document.getElementById('rollButton').addEventListener('click', function () {
            // Mevcut d√ºz D20 atƒ±≈üƒ± i≈ülevi
            const modal = document.getElementById('rollModal');
            const modalResult = document.getElementById('modalResult');
            const modalTitle = document.getElementById('modalTitle');
            const rollDuration = 1000;

            modal.style.display = 'flex';
            modalTitle.textContent = `D√ºz D20 Zar Atƒ±≈üƒ±`;

            modalResult.classList.add('modal-rolling');
            modalResult.textContent = 'Zar Atƒ±lƒ±yor...';
            modalResult.style.color = 'white';
            modalResult.style.backgroundColor = 'transparent';

            const animationInterval = setInterval(() => {
                modalResult.textContent = Math.floor(Math.random() * 20) + 1;
            }, 50);

            setTimeout(() => {
                clearInterval(animationInterval);
                const result = Math.floor(Math.random() * 20) + 1;
                const rankBonus = getRankDiceBonus();
                const totalResult = result + rankBonus;
                const rankBonusLabel = rankBonus >= 0 ? `+${rankBonus}` : `${rankBonus}`;

                modalResult.classList.remove('modal-rolling');
                modalTitle.textContent = `D20 Sonucu (Zar: ${result} ${rankBonusLabel} R√ºtbe Bonusu)`;

                if (result === 20) {
                    modalResult.style.color = '#76ff03';
                    modalResult.textContent = `KRƒ∞Tƒ∞K BA≈ûARI! (${totalResult})`;
                } else if (result === 1) {
                    modalResult.style.color = '#ff1744';
                    modalResult.textContent = `KRƒ∞Tƒ∞K HATA! (${totalResult})`;
                } else {
                    modalResult.style.color = 'white';
                    modalResult.textContent = totalResult;
                }
                modalResult.style.backgroundColor = 'transparent';
                document.getElementById('diceResult').textContent = `Son D20 Atƒ±≈üƒ±: ${totalResult}`;
                addDiceToHistory('D20', totalResult);

            }, rollDuration);
        });

        document.querySelectorAll('.multi-dice-btn').forEach(btn => {
            const sides = parseInt(btn.dataset.dice, 10);
            if (isNaN(sides)) {
                return;
            }
            btn.addEventListener('click', () => rollMultipleDice(sides));
        });

        document.getElementById('baseAttackButton').addEventListener('click', rollBaseAttack);

        document.getElementById('rollModal').addEventListener('click', function (event) {
            if (event.target.id === 'rollModal' || event.target.id === 'modalResult') {
                this.style.display = 'none';
            }
        });

        // KARAKTER DI≈ûA AKTARMA FONKSƒ∞YONU
        function exportCharacter(name) {
            let characterData = {};
            let exportName = name;

            if (name) {
                // Listeden gelen karakteri dƒ±≈üa aktar
                const dataKey = getCharacterDataKey(name);
                const storedData = localStorage.getItem(dataKey);
                if (!storedData) {
                    alert('Karakter verisi bulunamadƒ±.');
                    return;
                }
                characterData = JSON.parse(storedData);
            } else {
                // ≈ûu an a√ßƒ±k olan karakteri dƒ±≈üa aktar
                exportName = document.getElementById('isim').value || 'Karakter';
                const formElements = document.querySelectorAll('#characterSheetContainer input, #characterSheetContainer select, #characterSheetContainer textarea');
                formElements.forEach(element => {
                    if (element.id && element.id !== 'hpValueInput') {
                        characterData[element.id] = element.type === 'checkbox' ? element.checked : element.value;
                    }
                });
                characterData['raceBonusAppliedState'] = raceBonusAppliedState;
                const profilePic = document.getElementById('profilePicDisplay').src;
                if (profilePic && profilePic.startsWith('data:image')) {
                    characterData['profilFoto'] = profilePic;
                }
            }

            try {
                const dataStr = JSON.stringify(characterData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `${exportName.replace(/\s+/g, '_')}_karakter.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                alert('‚úÖ Karakter ba≈üarƒ±yla dƒ±≈üa aktarƒ±ldƒ±!');
            } catch (error) {
                alert('‚ùå Hata: ' + error.message);
            }
        }

        // KARAKTER ƒ∞√áE AKTARMA FONKSƒ∞YONU
        function importCharacterFromFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const characterData = JSON.parse(event.target.result);

                        // T√ºm verileri form alanlarƒ±na y√ºkle
                        for (const id in characterData) {
                            if (id === 'raceBonusAppliedState') {
                                raceBonusAppliedState = characterData[id];
                                continue;
                            }

                            if (id === 'profilFoto') {
                                const display = document.getElementById('profilePicDisplay');
                                const placeholder = document.getElementById('profilePicPlaceholder');
                                if (characterData[id]) {
                                    display.src = characterData[id];
                                    display.style.display = 'block';
                                    placeholder.style.display = 'none';
                                } else {
                                    display.src = '';
                                    display.style.display = 'none';
                                    placeholder.style.display = 'flex';
                                }
                                continue;
                            }

                            const element = document.getElementById(id);
                            if (element) {
                                if (element.type === 'checkbox') {
                                    element.checked = !!characterData[id];
                                } else if (element.type !== 'file') { // Dosya inputlarƒ±na deƒüer atanamaz
                                    element.value = characterData[id];
                                }
                            }
                        }

                        // Karakteri g√∂ster ve g√ºncelle
                        showCharacterSheet(false);
                        updateCharacterSheet();

                        alert('‚úÖ Karakter ba≈üarƒ±yla y√ºklendi!');
                    } catch (error) {
                        alert('‚ùå Dosya y√ºklenirken hata olu≈ütu: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

    </script>

</body>

</html>